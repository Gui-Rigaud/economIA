name: Create .env file

on:
  push:
    branches:
      - main  # Ou o nome da branch que você deseja que dispare o workflow
  pull_request:
    branches:
      - main  # Ou o nome da branch que você deseja que dispare o workflow

jobs:
  create-env:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up GitHub CLI
      run: |
        sudo apt-get update
        sudo apt-get install -y gh

    - name: Run create_env script
      run: |
        #!/bin/bash

        create_env () {
          gh variable list | grep DEVELOPMENT_ENV_FILE | tr ';' '\n' | sed -e "s/DEVELOPMENT_ENV_FILE //; s/[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\}T[0-9]\{2\}:[0-9]\{2\}:[0-9]\{2\}Z//g" | grep "\S" > .env
          echo "$(tput setaf 2)ENV file was created!$(tput sgr0)"
        }

        if [ "$CI" == "true" ]; then
          create_env
        else
          if command -v gh &>/dev/null; then
            create_env
          else
            echo "$(tput setaf 1)Github Cli could not be found$(tput sgr0)"
            echo "Please install: https://cli.github.com/"
          fi
        fi
